/*
 * boids.js
 * https://github.com/after12am/boids.js
 *
 * Copyright 2012-2016 Satoshi Okami
 * Released under the MIT license
 */
var boids=function(){var t,e={VERSION:"1.4.0",THREE:{}},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.Vector3=function(){function t(e,i,n){o(this,t),this.x=e||0,this.y=i||0,this.z=n||0}return i(t,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new e.Vector3(this.x,this.y,this.z)}},{key:"add",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addSelf",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"sub",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"subSelf",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"multiply",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"multiplySelf",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"divideSelf",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return t?(this.x/=t,this.y/=t,this.z/=t):(this.x=0,this.y=0,this.z=0),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.lengthSq())}},{key:"lengthManhattan",value:function(){return this.x+this.y+this.z}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"cross",value:function(t,e){return this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this}},{key:"crossSelf",value:function(t){var e=this.x,i=this.y,o=this.z;return this.x=i*t.z-o*t.y,this.y=o*t.x-e*t.z,this.z=e*t.y-i*t.x,this}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){return(new e.Vector3).sub(this,t).lengthSq()}},{key:"isZero",value:function(){return this.lengthSq()<1e-4}},{key:"limitScalar",value:function(t){var e=this.lengthSq();if(e>t*t&&e>0){var i=t/Math.sqrt(e);this.x*=i,this.y*=i,this.z*=i}return this}}]),t}(),e.nextVehicleId=(t=0,function(){return t++}),e.getRandVec=function(){var t=new e.Vector3,i=360*Math.random()*Math.PI/180,o=2*Math.random()*Math.PI;return t.x=Math.sin(i)*Math.cos(o),t.y=Math.sin(i)*Math.sin(o),t.z=Math.cos(i),t};i=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.Vehicle=function(){function t(i,n,r){o(this,t),this.id=e.nextVehicleId(),this.mass=1,this.maxSpeed=4,this.maxTrailSize=10,this.position=new e.Vector3(i,n,r),this.velocity=new e.Vector3,this.trails=[]}return i(t,[{key:"update",value:function(){this.velocity.limitScalar(this.maxSpeed),this.position.addSelf(this.velocity),this.trails.push(this.position.clone()),this.trails.length>=this.maxTrailSize&&this.trails.shift()}},{key:"bounce",value:function(t,e,i){this.position.x>.5*t?(this.position.x=.5*t,this.velocity.x*=-1):this.position.x<.5*-t&&(this.position.x=.5*-t,this.velocity.x*=-1),this.position.y>.5*e?(this.position.y=.5*e,this.velocity.y*=-1):this.position.y<.5*-e&&(this.position.y=.5*-e,this.velocity.y*=-1),this.position.z>.5*i?(this.position.z=.5*i,this.velocity.z*=-1):this.position.z<.5*-i&&(this.position.z=.5*-i,this.velocity.z*=-1)}},{key:"wrap",value:function(t,e,i){this.position.x>.5*t?this.position.x=.5*-t:this.position.x<.5*-t&&(this.position.x=.5*t),this.position.y>.5*e?this.position.y=.5*-e:this.position.y<.5*-e&&(this.position.y=.5*e),this.position.z>.5*i?this.position.z=.5*-i:this.position.z<.5*-i&&(this.position.z=.5*i)}}]),t}();var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.SteeredVehicle=function(t){function a(t,i,n){o(this,a);var s=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t,i,n)),h=s,l=360*Math.random(),c=360*Math.random();return s.steeringForce=new e.Vector3,s.maxForce=1,s.wanderDistance=10,s.wanderRadius=5,s.wanderRange=10,s.pathIndex=0,s.pathThreshold=20,s.inSightDist=120,s.tooCloseDist=20,s.wander=function(){var t,i,o,n,r,s=new e.Vector3,a=new e.Vector3;s.set(h.velocity),s.normalize(),s.multiplyScalar(h.wanderDistance),t=h.wanderRadius,i=c,o=l*Math.PI/180,n=i*Math.PI/180,(r=new e.Vector3).x=t*Math.sin(o)*Math.cos(n),r.y=t*Math.sin(o)*Math.sin(n),r.z=t*Math.cos(o),a=r,l+=Math.random()*h.wanderRange-.5*h.wanderRange,c+=Math.random()*h.wanderRange-.5*h.wanderRange,h.steeringForce.addSelf(s.addSelf(a))},s}return s(a,t),i(a,[{key:"addForce",value:function(t){"object"==(void 0===t?"undefined":n(t))?this.steeringForce.addSelf(t):"number"==typeof t&&this.steeringForce.addScalar(t)}},{key:"update",value:function(){this.steeringForce.limitScalar(this.maxForce),this.steeringForce.multiplyScalar(1/this.mass),this.velocity.addSelf(this.steeringForce),function t(e,i,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,o)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(o):void 0}(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"update",this).call(this),this.steeringForce.set(0,0,0)}},{key:"seek",value:function(t){var i=new e.Vector3;i.set(t.x,t.y,t.z),i.subSelf(this.position),i.normalize(),i.multiplyScalar(this.maxSpeed),this.steeringForce.addSelf(i.subSelf(this.velocity))}},{key:"flee",value:function(t){var i=new e.Vector3;i.set(t.x,t.y,t.z),i.subSelf(this.position),i.normalize(),i.multiplyScalar(this.maxSpeed),this.steeringForce.subSelf(i.subSelf(this.velocity))}},{key:"arrive",value:function(t){var i=25*this.maxSpeed,o=new e.Vector3;o.set(t.x,t.y,t.z),o.subSelf(this.position),o.normalize();var n=this.position.distanceTo(t);n>i?o.multiplyScalar(this.maxSpeed):o.multiplyScalar(this.maxSpeed*n/i),this.steeringForce.addSelf(o.subSelf(this.velocity))}},{key:"pursue",value:function(t){var i=this.position.distanceTo(t.position)/this.maxSpeed,o=new e.Vector3;o.set(t.velocity.x,t.velocity.y,t.velocity.z),o.multiplyScalar(i);var n=new e.Vector3;n.set(t.position.x,t.position.y,t.position.z),n.addSelf(o),this.seek(n)}},{key:"evade",value:function(t){var i=this.position.distanceTo(t.position)/this.maxSpeed,o=new e.Vector3;o.set(t.velocity.x,t.velocity.y,t.velocity.z),o.multiplyScalar(i);var n=new e.Vector3;n.set(t.position.x,t.position.y,t.position.z),n.subSelf(o),this.flee(n)}},{key:"patrol",value:function(t,e){e=e||!1;var i=this.pathIndex>=t.length-1;this.position.distanceTo(t[this.pathIndex])<this.pathThreshold&&(i&&e?this.pathIndex=0:i||this.pathIndex++),i&&!e?this.arrive(t[this.pathIndex]):this.seek(t[this.pathIndex])}},{key:"flock",value:function(t){var i=new e.Vector3,o=new e.Vector3,n=0;i.set(this.velocity.x,this.velocity.y,this.velocity.z);for(var r=0;r<t.length;r++)t[r].id!=this.id&&this.inSight(t[r].position)&&(i.addSelf(t[r].velocity),o.addSelf(t[r].position),n++,this.tooClose(t[r].position)&&this.flee(t[r].position));n>0&&(o.multiplyScalar(1/n),this.seek(o),i.multiplyScalar(1/n),this.steeringForce.addSelf(i.subSelf(this.velocity)))}},{key:"randomWalk",value:function(){var t=e.getRandVec();t.normalize(),t.multiplyScalar(this.maxSpeed),this.steeringForce.addSelf(t.subSelf(this.velocity))}},{key:"inSight",value:function(t){if(this.position.distanceTo(t)>this.inSightDist)return!1;var i=new e.Vector3;i.set(this.velocity.x,this.velocity.y,this.velocity.z),i.normalize();var o=new e.Vector3;return o.set(t),o.subSelf(this.position),!(o.dot(i)<0)}},{key:"tooClose",value:function(t){return this.position.distanceTo(t)<this.tooCloseDist}}]),a}(e.Vehicle);i=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}return e.BiologicalVehicle=function(t){function n(t,i,s){o(this,n);var a=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,i,s));return a.age=0,a.lifeSpan=1,a.remainingLifePer=1,e.SteeredVehicle.call(a,t,i,s),a}return s(n,t),i(n,[{key:"aging",value:function(t){this.age+=t;var e=(this.lifeSpan-this.age)/this.lifeSpan;this.remainingLifePer=Math.max(0,Math.min(1,e))}},{key:"isDead",value:function(){return this.age>this.lifeSpan}}]),n}(e.SteeredVehicle),e.THREE.MeshObject=function(t,e){THREE.Mesh.call(this,t,e)},e.THREE.MeshObject.prototype=Object.create(THREE.Mesh.prototype),e.THREE.MeshObject.prototype.v=function(t,e,i){},e.THREE.MeshObject.prototype.f3=function(t,e,i){},e.THREE.Bird=function(t){function i(t,e,i){n.vertices.push(new THREE.Vector3(t,e,i))}function o(t,e,i){n.faces.push(new THREE.Face3(t,e,i))}(t=t||{}).color=void 0==t.color?6579300:t.color,t.position=void 0==t.position?new e.Vector3(0,0,0):t.position;var n=new THREE.Geometry,r=new THREE.MeshBasicMaterial({color:new THREE.Color(t.color),side:THREE.DoubleSide});i(5,0,0),i(-5,-2,1),i(-5,0,0),i(-5,-2,-1),i(0,2,-6),i(0,2,6),i(2,0,0),i(-3,0,0),o(0,2,1),o(0,3,2),o(4,7,6),o(5,6,7),THREE.Mesh.call(this,n,r),this.phase=Math.floor(62.83*Math.random()),this.behavior=new e.SteeredVehicle(t.position.x,t.position.y,t.position.z),this.behavior.maxForce=.15},e.THREE.Bird.prototype=Object.create(THREE.Mesh.prototype),e.THREE.Bird.prototype.seek=function(t){this.behavior.seek(t)},e.THREE.Bird.prototype.flee=function(t){this.behavior.flee(t)},e.THREE.Bird.prototype.arrive=function(t){this.behavior.arrive(t)},e.THREE.Bird.prototype.pursue=function(t){this.behavior.pursue(t)},e.THREE.Bird.prototype.evade=function(t){this.behavior.evade(t)},e.THREE.Bird.prototype.patrol=function(t,e){this.behavior.patrol(t,e)},e.THREE.Bird.prototype.flock=function(t){this.behavior.flock(t)},e.THREE.Bird.prototype.randomWalk=function(){this.behavior.randomWalk()},e.THREE.Bird.prototype.inSight=function(t){this.behavior.inSight(t)},e.THREE.Bird.prototype.tooClose=function(t){this.behavior.tooClose(t)},e.THREE.Bird.prototype.wrap=function(t,e,i){this.behavior.wrap(t,e,i)},e.THREE.Bird.prototype.bounce=function(t,e,i){this.behavior.bounce(t,e,i)},e.THREE.Bird.prototype.wander=function(){this.behavior.wander()},e.THREE.Bird.prototype.inSight=function(t){return this.behavior.inSight(t)},e.THREE.Bird.prototype.update=function(t){t=t||{},this.behavior.update(),this.flap(),this.position.x=this.behavior.position.x,this.position.y=this.behavior.position.y,this.position.z=this.behavior.position.z,void 0!=t.color&&(this.material.color=new THREE.Color(t.color))},e.THREE.Bird.prototype.flap=function(){this.rotation.y=Math.atan2(-this.behavior.velocity.z,this.behavior.velocity.x),this.rotation.z=Math.asin(this.behavior.velocity.y/this.behavior.velocity.length()),this.phase=(this.phase+(Math.max(0,this.rotation.z)+.1))%62.83,this.geometry.verticesNeedUpdate=!0,this.geometry.vertices[5].y=this.geometry.vertices[4].y=5*Math.sin(this.phase)},e}();
